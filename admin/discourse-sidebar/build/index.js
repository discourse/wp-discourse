!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var s=n(7);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var s=n(8),i=n(1);e.exports=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?i(e):t}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}e.exports=function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(t,s){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,s)}e.exports=n},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=s=function(e){return n(e)}:e.exports=s=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},s(t)}e.exports=s},function(e,t,n){"use strict";n.r(t);var s=n(1),i=n.n(s),a=n(6),o=n.n(a),r=n(5),l=n.n(r),c=n(4),u=n.n(c),p=n(3),h=n.n(p),d=n(2),b=n.n(d),g=n(0),m=wp.i18n.__,f=wp.editPost,w=f.PluginSidebar,y=f.PluginSidebarMoreMenuItem,k=wp.components,v=k.PanelBody,O=(k.TextControl,wp.element),C=O.Component,P=O.Fragment,E=wp.data.withSelect,j=(wp.compose.compose,wp.plugins.registerPlugin),_=(0,wp.element.createElement)("img",{width:20,height:20,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTExIDc5LjE1ODMyNSwgMjAxNS8wOS8xMC0wMToxMDoyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUYxNjlGNkY3NjAxMTFFNjkyRkZBRTlDQTMwREJDQzUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUYxNjlGNzA3NjAxMTFFNjkyRkZBRTlDQTMwREJDQzUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxRjE2OUY2RDc2MDExMUU2OTJGRkFFOUNBMzBEQkNDNSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxRjE2OUY2RTc2MDExMUU2OTJGRkFFOUNBMzBEQkNDNSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pq7th6IAAAP8SURBVHjalFbbT5tlHH56grKWnicw5ijdAjNGg5CxbPGIM7qx7cIlxihxd7oLr/wHlpgsu/FWjbdeeOWFwUQixmW6GGbKpDKcgqhj7AA90CM9t/j8Xr+vKZW08Gue0O/jfZ/n/R3fGg73+dHE2ogzxEvEU4SPMBJxYon4kZjUnnc0QxOBD4j3iX40txjxKfEhUdqNwJPE58SwWmAwoFQqoVQsolqtwmgyoa2tDWazGVtbW/X7FokJYrb+pbGB/DliTsiNRiPyuRw2YjEY+HF7fejqOQCHw4FcNotoOKyEZZ1mg0SQeKWe0Fz3PUBck3cGCepGDE6XG8dOnIQ/cBgutwcmnrpcLiEaieB2KIRfgj+jnd54fT5UKhWdZ1oTW2oUmFTkDEl8Y4OkAbx69jwOPn5IhaO76zH0dHfB7Xaj3WpFMpXGt1Pf4KOrV7Fy9x/4+wMUL+tcX2sitRxckkQJeTIRRy9J35h4B06nEz6vFyPDQ/D3HYKJ8W+0UGgeFyfexh93fqeIv94TKZCPdYH7RK/EVBJ54c23MHD0CXXiU2MvorPT3rSM7q7cw8ljo8xZFr79+xUH7SFxUDL0gpDLm81MBkcGj6qY2237cOrl1uRi4t3lK1dQYojy+Zz++gAxJgJj8iQlJyHo6e1VZTgy/Aw67a3JdXvt9GmcePZ5hjihSlszJTAg38QtIXY4nHC5nAgE+rEX28fED42MwGazq/LVS1cEOvQn8UKEfCy7Dmv7ngTyhbyKv4coFAr6a58IqNqShimyW1OpJOx2G/ZqaZatgRxWelKt1ippq9aGErdKpYzVlRWeprBngYeP1lApVxSMhhptZNuosDGpfy0t4vr31+rruaWtcWys3n9AL5LIpFOwWCz6v37bJmC1dnBBGqG5ORRK5V2RS1hv3gyqA/29/CcS8Q20tdfyN10/Kv5rdYZq9Pgoq6J1ktPpDG78NIP1cASRSBi/3rrFsWJRHKyYZS6Z2SZQZOzFi7Pj402Js9kcVu6tYmHhDuLJJDY3M5ia/Arh9Udwe7z6GL/cOOwQjUVxZvwchoaeRjyRxPztBczOztKzCr06rhovzW6PcYTH2VClYkkNuh++m8Yyc+fkINTIZ4gv/icgwy3HeXLp3fcQDM5ifW1dzReLxYwjA4Po4wiRNSazCSkKPFhdxfLiIkOVgsvjUZVIgRSpXq+/0b7k3wvyINlPcGMkGoHD3qlq2sLulubLMgxym0kIhahYLCgPbDabGt/ayRPabJvf6cJRLS4bBI2mSCgk1SKTRkaCsdOoiDVy+QFwUYZr443Wvat6JImcXC6f+tGinfYT4rOdtsnqKSkMfWS0MIOGtEZ8g7jebMO/AgwANr2XXAf8LaoAAAAASUVORK5CYII="}),T="components-button is-button is-default is-primary is-large wpdc-button",S="components-button is-button is-default is-primary is-large wpdc-button active",N=Object(g.createElement)("svg",{className:"components-panel__arrow",width:"24px",height:"24px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-hidden":"true",focusable:"false"},Object(g.createElement)("g",null,Object(g.createElement)("path",{fill:"none",d:"M0,0h24v24H0V0z"})),Object(g.createElement)("g",null,Object(g.createElement)("path",{d:"M7.41,8.59L12,13.17l4.59-4.58L18,10l-6,6l-6-6L7.41,8.59z"}))),D=Object(g.createElement)("svg",{className:"components-panel__arrow",width:"24px",height:"24px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-hidden":"true",focusable:"false"},Object(g.createElement)("g",null,Object(g.createElement)("path",{fill:"none",d:"M0,0h24v24H0V0z"})),Object(g.createElement)("g",null,Object(g.createElement)("path",{d:"M12,8l-6,6l1.41,1.41L12,10.83l4.59,4.58L18,14L12,8z"}))),x=function(e){function t(e){return o()(this,t),u()(this,h()(t).call(this,e))}return b()(t,e),l()(t,[{key:"render",value:function(){return Object(g.createElement)("div",null,Object(g.createElement)(U,{forcePublish:this.props.forcePublish,published:this.props.published}),Object(g.createElement)(M,{statusMessage:this.props.statusMessage}),Object(g.createElement)(A,{publishingError:this.props.publishingError}),Object(g.createElement)(I,{discoursePermalink:this.props.discoursePermalink}))}}]),t}(C),U=function(e){function t(e){return o()(this,t),u()(this,h()(t).call(this,e))}return b()(t,e),l()(t,[{key:"render",value:function(){return this.props.forcePublish&&!this.props.published?Object(g.createElement)("p",{className:"wpdc-force-publish-message"},m("The Force Publish option is enabled for your site. All posts published on WordPress will be automatically published to Discourse.","wp-discourse")):""}}]),t}(C),M=function(e){function t(e){return o()(this,t),u()(this,h()(t).call(this,e))}return b()(t,e),l()(t,[{key:"render",value:function(){var e=this.props.statusMessage;return e?Object(g.createElement)("div",{className:"wpdc-publishing-response success"},e):""}}]),t}(C),A=function(e){function t(e){return o()(this,t),u()(this,h()(t).call(this,e))}return b()(t,e),l()(t,[{key:"render",value:function(){var e=this.props.publishingError;if(e){var t;switch(e){case"deleted_topic":t=m("Your post could not be published to Discourse. The associated Discourse topic may have been deleted. Unlink the post so that it can be published again.","wp-discourse");break;case"Not Found":t=m("Your post could not be updated on Discourse. The associated Discourse topic may have been deleted. Unlink the post so that it can be published again.","wp-discourse");break;case"queued_topic":t=m("Your post has been added to the Discourse approval queue. When it has been approved, you will need to link it to Discourse byselecting the 'Link to Existing Topic' option.","wp-discourse");break;case"Unprocessable Entity":t=m("Your post could not be published to Discourse. There may be an existing Discourse topic that is using its permalink. Try linking the post with that topic.","wp-discourse");break;case"Forbidden":t=m("Your post could not be published to Discourse. Check that your Discourse Username is set correctly on your WordPress profile page.","wp-discourse");break;default:t=e}return Object(g.createElement)("div",{className:"wpdc-publishing-response error"},t)}return""}}]),t}(C),I=function(e){function t(e){return o()(this,t),u()(this,h()(t).call(this,e))}return b()(t,e),l()(t,[{key:"render",value:function(){if(this.props.discoursePermalink){var e=encodeURI(this.props.discoursePermalink),t=Object(g.createElement)("a",{href:e,className:"wpdc-permalink-link",target:"_blank"},e);return Object(g.createElement)("div",{className:"wpdc-permalink"},m("Your post is linked with","wp-discourse")," ",t)}return""}}]),t}(C),R=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).handleChange=n.handleChange.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"handleChange",value:function(e){this.props.handlePublishMethodChange(e.target.value)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-publishing-options"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},m("Publishing Options","wp-discourse")),Object(g.createElement)("label",null,Object(g.createElement)("input",{type:"radio",name:"wpdc_publish_options",value:"publish_post",checked:"publish_post"===this.props.publishingMethod,onChange:this.handleChange}),m("New Topic","wp-discourse")),Object(g.createElement)("br",null),Object(g.createElement)("label",null,Object(g.createElement)("input",{type:"radio",name:"wpdc_publish_options",value:"link_post",checked:"link_post"===this.props.publishingMethod,onChange:this.handleChange}),m("Link to Existing Topic","wp-discourse")),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}}]),t}(C),G=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).handleToBePublishedChange=n.handleToBePublishedChange.bind(i()(n)),n.handlePublishChange=n.handlePublishChange.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"handleToBePublishedChange",value:function(e){this.props.handleToBePublishedChange(e.target.checked)}},{key:"handlePublishChange",value:function(e){this.props.handlePublishChange(e)}},{key:"render",value:function(){var e=this.props.publishToDiscourse;return"publish"===this.props.postStatus?Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},m("Publish to Discourse","wp-discourse")),Object(g.createElement)("button",{className:this.props.busy?S:T,onClick:this.handlePublishChange},m("Publish to Discourse","wp-discourse"))):Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},m("Publish to Discourse","wp-discourse")),Object(g.createElement)("div",{className:"wpdc-publish-topic"},Object(g.createElement)("input",{type:"checkBox",className:"wpdc-publish-topic-checkbox",checked:e,onChange:this.handleToBePublishedChange}),m("Publish","wp-discourse"),Object(g.createElement)("p",{className:"wpdc-info"},m("Automatically publish the post to Discourse when it is published on WordPress.","wp-discourse"))))}}]),t}(C),Y=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).handleChange=n.handleChange.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"handleChange",value:function(e){this.props.handleCategoryChange(e.target.value)}},{key:"render",value:function(){var e=this;if(this.props.discourseCategories){var t=Object.values(this.props.discourseCategories).map(function(t){return Object(g.createElement)("option",{value:t.id,selected:parseInt(e.props.category_id,10)===parseInt(t.id,10)},t.name)});return Object(g.createElement)("div",{className:"wpdc-category-select wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},m("Category","wp-discourse")),Object(g.createElement)("select",{onChange:this.handleChange,className:"widefat"},t),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}return null}}]),t}(C),L=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).state={isBusy:!1,topicUrl:null},n.handleChange=n.handleChange.bind(i()(n)),n.handleClick=n.handleClick.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"handleChange",value:function(e){this.setState({topicUrl:e.target.value})}},{key:"handleClick",value:function(e){this.props.handleLinkTopicClick(this.state.topicUrl)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-link-post wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},m("Topic URL","wp-discourse")),Object(g.createElement)("input",{type:"url",className:"widefat wpdc-topic-url-input",onChange:this.handleChange,value:this.state.topicUrl}),Object(g.createElement)("button",{className:this.props.busy?S:T,onClick:this.handleClick},m("Link With Discourse","wp-discourse")))}}]),t}(C),Z=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).state={showPanel:!1},n.handleClick=n.handleClick.bind(i()(n)),n.togglePanel=n.togglePanel.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"handleClick",value:function(e){this.props.handleUnlinkFromDiscourseChange(e)}},{key:"togglePanel",value:function(){this.setState({showPanel:!this.state.showPanel})}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-panel-section-title"},Object(g.createElement)("button",{type:"button","aria-expanded":"false",className:"components-button components-panel__body-toggle",onClick:this.togglePanel},Object(g.createElement)("span",{"aria-hidden":"true"},this.state.showPanel?D:N),m("Unlink From Discourse","wp-discourse"))),Object(g.createElement)("div",{className:this.state.showPanel?"":"hidden"},Object(g.createElement)("p",{className:"wpdc-info"},m("Unlinking the post from Discourse will remove all Discourse metadata from the post.","wp-discourse")),Object(g.createElement)("button",{className:this.props.busy?S:T,onClick:this.handleClick},m("Unlink Post","wp-discourse"))))}}]),t}(C),B=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).state={showPanel:!1},n.handleClick=n.handleClick.bind(i()(n)),n.togglePanel=n.togglePanel.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"togglePanel",value:function(){this.setState({showPanel:!this.state.showPanel})}},{key:"handleClick",value:function(e){this.props.handleUpdateChange(e)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-panel-section-title"},Object(g.createElement)("button",{type:"button","aria-expanded":"false",className:"components-button components-panel__body-toggle",onClick:this.togglePanel},Object(g.createElement)("span",{"aria-hidden":"true"},this.state.showPanel?D:N),m("Update Discourse Topic","wp-discourse"))),Object(g.createElement)("div",{className:this.state.showPanel?"":"hidden"},Object(g.createElement)("p",{className:"wpdc-info"},m("Update the Discourse topic to the lastest saved version of the post.","wp-discourse")),Object(g.createElement)("button",{className:this.props.busy?S:T,onClick:this.handleClick},m("Update Topic","wp-discourse"))))}}]),t}(C),F=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).state={chosenTags:n.props.tags,inputContent:"",inputLength:1,maxTagsExceeded:!1},n.handleKeyPress=n.handleKeyPress.bind(i()(n)),n.handleChange=n.handleChange.bind(i()(n)),n.handleClick=n.handleClick.bind(i()(n)),n.focusInput=n.focusInput.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"focusInput",value:function(e){this.tagInput.focus()}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({inputContent:","===t?"":t,inputLength:0===t.length?1:t.length})}},{key:"handleKeyPress",value:function(e){var n=this,s=e.key,i=e.target.value;if("Enter"===s||","===s){var a=this.state.chosenTags;if(a.length>=this.props.maxTags)return this.setState({maxTagsExceeded:!0,inputContent:""}),null;a.push(i.trim().replace(/ /g,"-")),a=t.sanitizeArray(a),this.setState({chosenTags:a,inputContent:""},function(){n.props.handleTagChange(a)})}}},{key:"handleClick",value:function(e){var t=this,n=this.state.chosenTags,s=n.indexOf(e);s>-1&&(n.splice(s,1),this.setState({chosenTags:n,maxTagsExceeded:!1},function(){t.props.handleTagChange(n)}))}},{key:"render",value:function(){var e=this;if(this.props.allowTags){var n=this.state.maxTagsExceeded?m("You have exceeded the maximum number of allowed tags for your site. Remove a tag to add more.","wp-discourse"):"",s=t.sanitizeArray(this.state.chosenTags);return s=s.map(function(t,n){return Object(g.createElement)("span",{className:"components-form-token-field__token",key:t},Object(g.createElement)("span",{className:"components-form-token-field__token-text"},Object(g.createElement)("span",{className:"screen-reader-text"},t),Object(g.createElement)("span",{"aria-hidden":"true"},t)),Object(g.createElement)("button",{type:"button","aria-label":"Remove Tag",className:"components-button components-icon-button components-form-token-field__remove-token",onClick:e.handleClick.bind(e,t),key:t},Object(g.createElement)("svg",{"aria-hidden":"true",role:"img",focusable:"false",className:"dashicon dashicons-dismiss",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20"},Object(g.createElement)("path",{d:"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm5 11l-3-3 3-3-2-2-3 3-3-3-2 2 3 3-3 3 2 2 3-3 3 3z"}))))}),Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},m("Tags","wp-discourse")),Object(g.createElement)("div",{className:"components-form-token-field__input-container",onClick:this.focusInput},s,Object(g.createElement)("input",{type:"text",size:this.state.inputLength,className:"components-form-token-field__input",onChange:this.handleChange,onKeyPress:this.handleKeyPress,value:this.state.inputContent,ref:function(t){e.tagInput=t}})),Object(g.createElement)("div",{className:this.state.maxTagsExceeded?"wpdc-info":""},n),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}return null}}],[{key:"sanitizeArray",value:function(e){return e=e.sort().reduce(function(e,t){var n=e.length;return 0!==n&&e[n-1]===t||""===t.trim()||e.push(t),e},[])}}]),t}(C),W=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).state={pinTopic:n.props.pinTopic,pinUntil:n.props.pinUntil},n.handleUpdateDate=n.handleUpdateDate.bind(i()(n)),n.handleToBePinnedChange=n.handleToBePinnedChange.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"handleUpdateDate",value:function(e){this.setState({pinUntil:e.target.value}),this.props.handlePinChange(this.state.pinTopic,e.target.value)}},{key:"handleToBePinnedChange",value:function(e){this.setState({pinTopic:e.target.checked}),this.props.handlePinChange(e.target.checked,this.state.pinUntil)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},m("Pin Topic","wp-discourse")),Object(g.createElement)("label",null,Object(g.createElement)("input",{type:"checkbox",onChange:this.handleToBePinnedChange,checked:this.state.pinTopic}),m("Pin Discourse Topic","wp-discourse")),Object(g.createElement)("br",null),Object(g.createElement)("label",{className:"wpdc-pin-until-input"},m("Pin Until","wp-discourse"),Object(g.createElement)("br",null),Object(g.createElement)("input",{type:"date",className:"widefat",onChange:this.handleUpdateDate,value:this.state.pinUntil})),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}}]),t}(C),z=function(e){function t(e){var n;return o()(this,t),(n=u()(this,h()(t).call(this,e))).state={published:!1,postStatus:"",publishingMethod:"publish_post",forcePublish:pluginOptions.forcePublish,publishToDiscourse:!1,publishPostCategory:pluginOptions.defaultCategory,allowTags:pluginOptions.allowTags,maxTags:pluginOptions.maxTags,topicTags:[],pinTopic:!1,pinUntil:null,discoursePostId:null,discoursePermalink:null,publishingError:null,busyUnlinking:!1,busyUpdating:!1,busyLinking:!1,busyPublishing:!1,statusMessage:null,discourseCategories:null},n.updateStateFromDatabase(n.props.postId),n.getDiscourseCategories(),n.handleToBePublishedChange=n.handleToBePublishedChange.bind(i()(n)),n.handlePublishChange=n.handlePublishChange.bind(i()(n)),n.handleCategoryChange=n.handleCategoryChange.bind(i()(n)),n.handleTagChange=n.handleTagChange.bind(i()(n)),n.handleUnlinkFromDiscourseChange=n.handleUnlinkFromDiscourseChange.bind(i()(n)),n.handlePublishMethodChange=n.handlePublishMethodChange.bind(i()(n)),n.handleUpdateChange=n.handleUpdateChange.bind(i()(n)),n.handleLinkTopicClick=n.handleLinkTopicClick.bind(i()(n)),n.handlePinChange=n.handlePinChange.bind(i()(n)),n}return b()(t,e),l()(t,[{key:"getDiscourseCategories",value:function(){var e=this;wp.apiRequest({path:"/wp-discourse/v1/get-discourse-categories",method:"GET",data:{get_categories_nonce:pluginOptions.get_categories_nonce}}).then(function(t){e.setState({discourseCategories:t})},function(e){return null})}},{key:"updateStateFromDatabase",value:function(e){var t=this;if(this.isAllowedPostType()){var n,s=this.props.post.type;switch(s){case"post":n="posts";break;case"page":n="pages";break;default:n=s}wp.apiFetch({path:"/wp/v2/".concat(n,"/").concat(e),method:"GET"}).then(function(e){if(e.meta){var n=e.meta,s="deleted_topic"!==n.wpdc_publishing_error&&"queued_topic"!==n.wpdc_publishing_error&&1===parseInt(n.publish_to_discourse,10);return t.setState({published:n.discourse_post_id>0,postStatus:e.status,publishToDiscourse:s,publishPostCategory:n.publish_post_category>0?n.publish_post_category:pluginOptions.defaultCategory,topicTags:n.wpdc_topic_tags.split(","),pinTopic:n.wpdc_pin_topic>0,pinUntil:n.wpdc_pin_until,discoursePostId:n.discourse_post_id,discoursePermalink:n.discourse_permalink,publishingError:n.wpdc_publishing_error}),null}},function(e){return null})}}},{key:"isAllowedPostType",value:function(){return pluginOptions.allowedPostTypes.indexOf(this.props.post.type)>=0}},{key:"handlePublishMethodChange",value:function(e){this.setState({publishingMethod:e})}},{key:"handleToBePublishedChange",value:function(e){var t=this;this.setState({publishToDiscourse:e,statusMessage:""},function(){wp.apiRequest({path:"/wp-discourse/v1/set-publish-meta",method:"POST",data:{set_publish_meta_nonce:pluginOptions.set_publish_meta_nonce,id:t.props.postId,publish_to_discourse:t.state.publishToDiscourse?1:0}}).then(function(e){return null},function(e){return null})})}},{key:"handleCategoryChange",value:function(e){var t=this;this.setState({publishPostCategory:e},function(){wp.apiRequest({path:"/wp-discourse/v1/set-category-meta",method:"POST",data:{set_category_meta_nonce:pluginOptions.set_category_meta_nonce,id:t.props.postId,publish_post_category:e}}).then(function(e){return null},function(e){return null})})}},{key:"handlePinChange",value:function(e,t){var n=this;this.setState({pinTopic:e,pinUntil:t},function(){wp.apiRequest({path:"/wp-discourse/v1/set-pin-meta",method:"Post",data:{set_pin_meta_nonce:pluginOptions.set_pin_meta_nonce,id:n.props.postId,wpdc_pin_topic:e?1:0,wpdc_pin_until:t}}).then(function(e){return null},function(e){return null})})}},{key:"handleTagChange",value:function(e){var t=this;this.setState({topicTags:e},function(){var n=e.join(",");wp.apiRequest({path:"/wp-discourse/v1/set-tag-meta",method:"POST",data:{set_tag_meta_nonce:pluginOptions.set_tag_meta_nonce,id:t.props.postId,wpdc_topic_tags:n}}).then(function(e){return null},function(e){return null})})}},{key:"handleLinkTopicClick",value:function(e){var t=this;this.setState({busyLinking:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/link-topic",method:"POST",data:{link_topic_nonce:pluginOptions.link_topic_nonce,id:this.props.postId,topic_url:e}}).then(function(e){return t.setState({busyLinking:!1}),e.discourse_permalink?t.setState({published:!0,discoursePermalink:e.discourse_permalink,publishingError:null}):t.setState({publishingError:m("There has been an error linking your post with Discourse.","wp-discourse")}),null},function(e){var n=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:m("There has been an error linking your post with Discourse.","wp-discourse");return t.setState({busyLinking:!1,published:!1,publishingError:n}),null})}},{key:"handleUnlinkFromDiscourseChange",value:function(e){var t=this;this.setState({busyUnlinking:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/unlink-post",method:"POST",data:{unlink_post_nonce:pluginOptions.unlink_post_nonce,id:this.props.postId}}).then(function(e){return t.setState({busyUnlinking:!1,published:!1,publishingMethod:"link_post",discoursePermalink:null,statusMessage:m("Your post has been unlinked from Discourse.","wp-discourse")}),null},function(e){return null})}},{key:"handlePublishChange",value:function(e){var t=this;this.setState({busyPublishing:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/publish-topic",method:"POST",data:{publish_topic_nonce:pluginOptions.publish_topic_nonce,id:this.props.postId}}).then(function(e){var n="success"===e.publish_response;return t.setState({busyPublishing:!1,published:n,publishingError:n?null:e.publish_response,publishingMethod:e.publish_response="link_post",discoursePermalink:e.discourse_permalink}),null},function(e){var n=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:m("There has been an error linking your post with Discourse.","wp-discourse");return t.setState({busyPublishing:!1,published:!1,publishingError:n}),null})}},{key:"handleUpdateChange",value:function(e){var t=this;this.setState({busyUpdating:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/update-topic",method:"POST",data:{update_topic_nonce:pluginOptions.update_topic_nonce,id:this.props.postId}}).then(function(e){var n,s="success"===e.update_response;return s&&(n=m("The Discourse topic has been updated!","wp-discourse")),t.setState({busyUpdating:!1,statusMessage:n,publishingError:s?null:e.update_response}),null},function(e){var n=m("There was an error updating the Discourse topic.","wp-discourse");return t.setState({busyUpdating:!1,statusMessage:n}),null})}},{key:"componentDidUpdate",value:function(e){if(this.isAllowedPostType()){var t=this.props.post,n=e.post,s=this.props.post.meta,i=e.post.meta;if(s&&i&&(t.status!==n.status||s.discourse_post_id!==i.discourse_post_id||s.wpdc_publishing_response!==i.wpdc_publishing_response||s.wpdc_publishing_error!==i.wpdc_publishing_error)){var a="deleted_topic"!==s.wpdc_publishing_error&&"queued_topic"!==s.wpdc_publishing_error&&1===parseInt(s.publish_to_discourse,10);this.setState({published:s.discourse_post_id>0,postStatus:t.status,publishToDiscourse:a,discoursePostId:s.discourse_post_id,discoursePermalink:s.discourse_permalink,publishingError:s.wpdc_publishing_error})}}}},{key:"render",value:function(){if(this.isAllowedPostType()){var e,t=this.state.published,n=this.state.forcePublish;return e=t||n?n?null:Object(g.createElement)("div",{className:"wpdc-published-post"},Object(g.createElement)(B,{published:this.state.published,busy:this.state.busyUpdating,handleUpdateChange:this.handleUpdateChange,forcePublish:this.state.forcePublish}),Object(g.createElement)(Z,{published:this.state.published,handleUnlinkFromDiscourseChange:this.handleUnlinkFromDiscourseChange,busy:this.state.busyUnlinking,forcePublish:this.state.forcePublish})):Object(g.createElement)("div",{className:"wpdc-not-published"},Object(g.createElement)(R,{handlePublishMethodChange:this.handlePublishMethodChange,publishingMethod:this.state.publishingMethod}),"publish_post"===this.state.publishingMethod?Object(g.createElement)("div",{className:"wpdc-publish-to-discourse"},Object(g.createElement)(Y,{category_id:this.state.publishPostCategory,handleCategoryChange:this.handleCategoryChange,discourseCategories:this.state.discourseCategories}),Object(g.createElement)(F,{handleTagChange:this.handleTagChange,tags:this.state.topicTags,allowTags:this.state.allowTags,maxTags:this.state.maxTags}),Object(g.createElement)(W,{handlePinChange:this.handlePinChange,pinTopic:this.state.pinTopic,pinUntil:this.state.pinUntil}),Object(g.createElement)(G,{postStatus:this.state.postStatus,publishToDiscourse:this.state.publishToDiscourse,handleToBePublishedChange:this.handleToBePublishedChange,handlePublishChange:this.handlePublishChange,busy:this.state.busyPublishing})):Object(g.createElement)("div",{className:"wpdc-link-to-discourse"},Object(g.createElement)(L,{busy:this.state.busyLinking,handleLinkTopicClick:this.handleLinkTopicClick}))),Object(g.createElement)(P,null,Object(g.createElement)(y,{target:"discourse-sidebar"},m("Discourse","wp-discourse")),Object(g.createElement)(w,{name:"discourse-sidebar",title:m("Discourse","wp-discourse")},Object(g.createElement)(v,null,Object(g.createElement)("div",{className:"wpdc-sidebar"},Object(g.createElement)(x,{published:this.state.published,forcePublish:this.state.forcePublish,publishingError:this.state.publishingError,discoursePermalink:this.state.discoursePermalink,statusMessage:this.state.statusMessage}),e))))}return null}}]),t}(C);j("discourse-sidebar",{icon:_,render:E(function(e,t){t.forceIsSaving;var n=e("core/editor"),s=n.getCurrentPostId,i=n.getCurrentPost;return{postId:s(),post:i()}})(z)})}]);